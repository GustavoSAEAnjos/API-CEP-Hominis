{% extends "base.html" %} {% block titulo %}Hominis - Cadastrar Novo Funcionario
{% endblock %} {% block header %}
<a href="{{ url_for('principal') }}" class="botao-header btn">Inicio</a>
{% endblock %} {% block conteudo %}
<div style="width: 80%">
  <form action="/cadastrar" method="post">
    <div class="header-caixa">
      <button class="botao-header-caixa" onclick="mostrarAba('dados')">
        Dados Pessoais
      </button>
      <button
        class="botao-header-caixa"
        style="border-left: 1px solid white; border-right: 1px solid white"
        onclick="mostrarAba('contatos')"
      >
        Contatos
      </button>
      <button class="botao-header-caixa" onclick="mostrarAba('endereco')">
        Endereço
      </button>
    </div>
    <div class="caixa-add">
      <div id="dados" class="aba ativa">
        <div class="itens-aba">
          <div class="campo">
            <label for="nome">Nome Completo</label>
            <input type="text" id="nome" class="inputs" name="nome" required />
          </div>
          <div class="campo">
            <label for="genero">Gênero (Opicional)</label>
            <input type="text" id="genero" class="inputs" name="genero" />
          </div>
        </div>

        <div class="itens-aba">
          <div class="campo">
            <label for="cpf">CPF/CNPJ</label>
            <input type="text" id="cpf" class="inputs" name="cpf" required />
          </div>
          <div class="campo">
            <label for="estado-civil">Estado Civil (Opicional)</label>
            <input
              type="text"
              id="estado-civil"
              class="inputs"
              name="estado-civil"
            />
          </div>
          <div class="campo">
            <label for="ocupacao">Profissão/Ocupação</label>
            <input
              type="text"
              id="ocupacao"
              class="inputs"
              name="ocupacao"
              required
            />
          </div>
        </div>

        <div class="itens-aba">
          <div class="campo">
            <label for="data-nasc-fund" style="font-size: 12px"
              >Data de Nascimento/Fundação</label
            >
            <input
              type="text"
              id="data-nasc-fund"
              class="inputs"
              name="data_nasc_fund"
              required
            />
          </div>
          <div class="campo">
            <label for="nacionalidade">Nacionalidade</label>
            <input
              type="text"
              id="nacionalidade"
              class="inputs"
              name="nacionalidade"
              required
            />
          </div>
        </div>
      </div>

      <div id="contatos" class="aba">
        <div class="itens-aba">
          <div class="campo">
            <label for="telefone-1">Telefone Primario</label>
            <input
              type="text"
              id="telefone-1"
              class="inputs"
              name="telefone_principal"
              required
            />
          </div>
          <div class="campo">
            <label for="email-2">E-mail Secundário</label>
            <input
              type="text"
              id="email-2"
              class="inputs"
              name="emai_secundario"
            />
          </div>
        </div>

        <div class="itens-aba">
          <div class="campo">
            <label for="telefone-2">Telefone Secundário</label>
            <input
              type="text"
              id="telefone-2"
              class="inputs"
              name="telefone_secundario"
            />
          </div>
          <div class="campo">
            <label for="senha">Senha</label><br />
            <input
              type="password"
              id="senha"
              class="inputs"
              name="senha"
              required
            />
          </div>
        </div>

        <div class="itens-aba">
          <div class="campo">
            <label for="email-1">E-mail Primario</label>
            <input
              type="text"
              id="email-1"
              class="inputs"
              name="email_principal"
              required
            />
          </div>
        </div>
      </div>

      <div id="endereco" class="aba">
        <div class="itens-aba">
          <div class="campo">
            <label for="cep">CEP<br /></label>
            <input type="text" id="cep" class="inputs" name="cep" required />
          </div>
          <div class="campo">
            <label for="Complemento">Complemento</label>
            <input
              type="text"
              id="complemento"
              class="inputs"
              name="complemento"
            />
          </div>
          <div class="campo">
            <label for="cidade">Cidade<br /></label>
            <input
              type="text"
              id="cidade"
              class="inputs"
              name="cidade"
              required
            />
          </div>
        </div>

        <div class="itens-aba">
          <div class="campo">
            <label for="log">Lograudouro</label>
            <input type="text" id="log" class="inputs" name="log" required />
          </div>
          <div class="campo">
            <label for="bairro">Bairro<br /></label>
            <input
              type="text"
              id="bairro"
              class="inputs"
              name="bairro"
              required
            />
          </div>
          <div class="campo">
            <label for="pais">País<br /></label>
            <input type="text" id="pais" class="inputs" name="pais" required />
          </div>
        </div>

        <div class="itens-aba">
          <div class="campo">
            <label for="numero">Número</label>
            <input
              type="text"
              id="numero"
              class="inputs"
              name="numero"
              required
            />
          </div>
          <div class="campo">
            <label for="estado">Estado<br /></label>
            <input
              type="text"
              id="estado"
              class="inputs"
              name="estado"
              required
            />
          </div>
        </div>
      </div>
    </div>
    <div class="footer-caixa">
      <div
        style="
          width: 50%;
          padding-left: 10px;
          display: flex;
          align-items: center;
        "
      >
        <a href="{{ url_for('principal') }}" class="botao-footer-caixa btn"
          >Voltar</a
        >
      </div>

      <div
        style="
          width: 50%;
          display: flex;
          align-items: center;
          justify-content: end;
          padding-right: 10px;
        "
      >
        <button class="botao-footer-caixa btn" type="submit" id="btnSalvar">
          Salvar
        </button>
      </div>
    </div>
  </form>
</div>

<script>
  document.getElementById("cep").addEventListener("blur", async function () {
    const cep = this.value.replace(/\D/g, ""); // remove tudo que não é número
    if (cep.length == 8) {
      try {
        // Requisição para o ViaCEP
        const resposta = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
        const dados = await resposta.json();

        if (dados.erro) {
          alert("CEP não encontrado.");
          return;
        }

        // Preenche os campos com os dados da API
        document.getElementById("log").value = dados.logradouro;
        document.getElementById("bairro").value = dados.bairro;
        document.getElementById("cidade").value = dados.localidade;
        document.getElementById("estado").value = dados.uf;
        document.getElementById("pais").value = "Brasil";

        // Complemento é opcional, mas se tiver, preenche
        if (dados.complemento) {
          document.getElementById("complemento").value = dados.complemento;
        }
      } catch (erro) {
        console.error("Erro ao buscar CEP:", erro);
        alert("Erro ao buscar o CEP. Verifique sua conexão.");
      }
    }
  });

  // Função genérica de máscara
  function aplicarMascara(input, formato) {
    input.addEventListener("input", () => {
      let valor = input.value.replace(/\D/g, ""); // remove tudo que não for número
      let resultado = "";
      let j = 0;

      for (let i = 0; i < formato.length; i++) {
        if (j >= valor.length) break;
        if (formato[i] === "0") {
          resultado += valor[j];
          j++;
        } else {
          resultado += formato[i];
        }
      }

      input.value = resultado;
    });
  }

  // Seleciona os campos
  const cpf = document.getElementById("cpf");
  const data = document.getElementById("data-nasc-fund");
  const tel1 = document.getElementById("telefone-1");
  const tel2 = document.getElementById("telefone-2");
  const cep = document.getElementById("cep");

  // Aplica as máscaras
  aplicarMascara(cpf, "000.000.000-00");
  aplicarMascara(data, "00/00/0000");
  aplicarMascara(tel1, "(00) 00000-0000");
  aplicarMascara(tel2, "(00) 00000-0000");
  aplicarMascara(cep, "00000-000");

  document.addEventListener("DOMContentLoaded", () => {
    const form = document.querySelector("form");
    const camposObrigatorios = form.querySelectorAll("[required]");
    const botaoSalvar = document.getElementById("btnSalvar");

    // Começa desabilitado
    botaoSalvar.disabled = true;
    botaoSalvar.style.opacity = "0.6";
    botaoSalvar.style.cursor = "not-allowed";

    function verificarCampos() {
      let tudoPreenchido = true;

      camposObrigatorios.forEach((campo) => {
        if (!campo.value.trim()) {
          tudoPreenchido = false;
        }
      });

      if (tudoPreenchido) {
        botaoSalvar.disabled = false;
        botaoSalvar.style.opacity = "1";
        botaoSalvar.style.cursor = "pointer";
      } else {
        botaoSalvar.disabled = true;
        botaoSalvar.style.opacity = "0.6";
        botaoSalvar.style.cursor = "not-allowed";
      }
    }

    // Escuta mudanças em todos os campos obrigatórios
    camposObrigatorios.forEach((campo) => {
      campo.addEventListener("input", verificarCampos);
      campo.addEventListener("blur", verificarCampos);
    });

    // Checa ao carregar a página (útil se já tiver valores)
    verificarCampos();
  });
</script>

{% endblock %}
